(function($){tinymce.PluginManager.add("fmc",function(editor,url){editor.addButton("fmc_button",{text:false,title:"flexmlsÂ® Connect Shortcode Generator",image:fmcAjax.pluginurl+"/assets/images/fbs_small.png",onclick:function(){var H=jQuery(window).height()-(84+35),W=753;tb_show("flexmls&reg; Connect Shortcode Generator","#TB_inline?width="+W+"&height="+H+"&inlineId=fmc_shortcode_window");jQuery("#TB_window").width(W+30);}});});$(function(){var container_body='<div id="fmc_shortcode_window"></div>';var form=jQuery(container_body);form.appendTo("body").hide();jQuery.getJSON(fmcAjax.ajaxurl,{action:"fmcShortcodeContainer"},function(data){jQuery("#fmc_shortcode_window").html(data.body);form.find(".fmc_which_shortcode").click(function(){jQuery(".flexmls_connect__widget_menu li").removeClass("fmc_selected_shortcode");jQuery(this).parent().addClass("fmc_selected_shortcode");jQuery("#fmc_shortcode_window_content").html("<p class='first'>loading...</p>");var which_shortcode=jQuery(this).attr("data-connect-shortcode");jQuery.getJSON(fmcAjax.ajaxurl,{action:which_shortcode+"_shortcode"},function(idata){jQuery("#fmc_shortcode_window_content").html('<h3 id="fmc_box_title">'+idata.title+"</h3>"+idata.body);if(which_shortcode==="fmcSearchResults"){jQuery("#fmc_shortcode_field_property_type").dependentDropdown("#fmc_shortcode_field_property_sub_type");}jQuery(".fmc_shortcode_submit").click(function(){var widget=jQuery("input[name='widget']").val();var send_data={action:widget+"_shortcode_gen"};var form_fields_list=jQuery('input[name="shortcode_fields_to_catch"]').val();var form_fields=form_fields_list.split(",");jQuery.each(form_fields,function(){var field_name=this.trim();var field_element=jQuery('[fmc-field="'+field_name+'"]');var field_value=field_element.val();value="";if(field_element.attr("fmc-type")=="select"){field_value=jQuery(":selected",field_element).map(function(){return jQuery(this).val();}).get().join();}else{if(field_element.attr("fmc-type")=="checkbox"){field_value=jQuery(':checked[fmc-field="'+field_name+'"]').map(function(){return jQuery(this).val();}).get().join();}}send_data[field_name]=field_value;});jQuery.getJSON(fmcAjax.ajaxurl,send_data,function(data){tinyMCE.activeEditor.execCommand("mceInsertContent",0,data.body);tb_remove();return false;});});});});});});})(jQuery);

